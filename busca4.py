from selenium import webdriver
import time
from selenium.webdriver.common.keys import Keys

processos = ['10144797920148260037',
'00167189320128260053',
'00884412120188260100',
'00044473720158260024',
'4429243920078090082',
'00026776120188260587',
'00114931020188260077',
'01222131920118260100',
'00288736520118260053',
'00288822720118260053',
'00279841420118260053',
'01445644920128260100',
'10035793720178260100',
'00030470620188260081',
'02174909620108260100',
'00074177720198260506',
'00094838320198260068',
'00004774220138260204',
'00280831920128260224',
'00049825220198260047',
'00178694020138260577',
'00464528920128260053',
'00036568720138260008',
'00529725920128260346',
'00061191220138260619',
'00013192220138260204',
'00070783220138260053',
'00026810820188260132',
'00172885520138260664',
'30034947720138260481',
'00204457920138260003',
'30008013920138260411',
'40035508220138260032',
'00102229120188260100',
'30008259620138260369',
'30024884820138260024',
'10039486320148260576',
'10927357520138260100',
'30012925720138260472',
'00014978920148260024',
'00003147220148260060',
'40047588320138260038',
'10085250420148260053',
'10008745720138260698',
'00065672920138260572',
'00029523820148260526',
'10005861820148260038',
'00023097420148260431',
'10238090820148260100',
'10038862720148260510',
'00098122920148260664',
'10051787720148260597',
'00014166920148260080',
'10846561020138260100',
'00011049020148260081',
'00042856420148260222',
'00016537720148260024',
'00007350820148260369',
'10741261020148260100',
'00066342620148260356',
'10077185120148260451',
'00045907720148260180',
'00299234720198260506',
'10065125720148260077',
'10123041520148260037',
'10067469120148260286',
'10046266420148260322',
'00006258920148260407',
'10079557720148260001',
'00034587520148260538',
'00063914820148260238',
'00031657820148260450',
'00121754020148260453',
'00042615820148260538',
'00103507820148260318',
'00067975720148260242',
'00016129220138260397',
'10221763120148260562',
'10221763120148260562',
'10143454720148260071',
'10005944620158260236',
'10013271620158260073',
'00022847220158260125',
'00025349720158260063',
'00029697120158260063',
'10188867120158260562',
'00031783620158260129',
'00185467120154036301',
'10233149620158260562',
'00051875920138260575',
'10002657420158260352',
'00067008920158260220',
'10002359520158260301',
'10003172920158260301',
'00015037120198260396',
'10006592320158260145',
'00005545320148260095',
'10004147220158260028',
'10322570520158260562',
'10015859520168260071',
'10001727320168260418',
'00005840420158260435',
'10000457720168260696',
'10012059620168260451',
'10068513120168260114',
'10003645920168260368',
'10005018520168260418',
'10004143220168260418',
'10002143120168260222',
'10002365720158260244',
'10002726520168260244',
'10001310920168260418',
'00037995320198260077',
'10006447220168260063',
'10083571420168260576',
'10001617720168260698',
'10044780720168260541',
'10009378420168260534',
'10309389620168260196',
'10051651220178260100',
'00029193920178260010',
'10299387320148260053',
'10041690920178260037',
'10002410220178260247',
'10047529120178260037',
'10228511720178260100',
'00009756520198260128',
'10254567920178260602',
'00002626820198260491',
'00284677420198260114',
'00104790420188260008',
'10011830820168260073',
'10001343820168260458',
'10069897520178260077',
'10022585220178260104',
'10012315220168260077',
'10038690920178260082',
'00082236620198260004',
'10021667120178260396',
'10067920520178260568',
'11270578220178260100',
'10010565220188260218',
'10544032720178260576',
'00080410320018260363',
'00007587820198260077',
'00205631620178260100',
'10022984720188260347',
'10002233520188260347',
'10025981720188260506',
'10038228420168260562',
'00246301920198260564',
'10036584620178260575',
'10036584620178260575',
'10041832720188260176',
'00003948620198260698',
'00300188920198260114',
'10005787720158260144',
'10056285720168260562',
'00061230420198260566',
'00030409720198260624',
'10038173420188260484',
'00674811020198260100',
'10004268720168260275',
'10002114020158260698',
'00001605420188260047',
'00011532920198260123',
'00035220720198260281',
'10006354120188260516',
'00042629620198260011',
'10052004720198260020',
'10014095620198260445',
'10087314220198260344',
'10427356120198260100',
'10088747720198260361',
'00546706520078260576',
'00494548120118260577',
'00088750920128260302',
'00318347620118260053',
'00155264720128260079',
'00076444820118260506',
'00458152120128260577',
'00125237920138260037',
'30031526320138260482',
'40041058120138260038',
'40041058120138260038',
'00121771020148260453',
'10190355520158260566',
'10028434920168260554',
'10012982520168260624',
'00026554820198260011',
'10000950820168260275',
'00082220320198260127',
'10067536120198260269']




options = webdriver.ChromeOptions()



preferences = {"download.default_directory": "C:/Users/rodri/Desktop/Projetos/unif"}

options.add_experimental_option("prefs", preferences)

driver_1 = webdriver.Chrome(options=options)

with open("andamento_4.txt", "w") as text_file:
    text_file.write('')

def busca_andamento(driver, processos, start=0, stop=len(processos)):
    
    i = 0
    for processo in processos[start:stop]:
        
        driver.get("https://www.jusbrasil.com.br/consulta-processual/?ref=navbar")
        time.sleep(2)
        try:

            pesquisa = driver.find_element_by_css_selector("#app-root > div > div > div.Home-section.Home-header > div.Home-header-container > div > div > div > div.SearchForm-wrapper > input")
            pesquisa.send_keys(processo)
            pesquisa.send_keys(Keys.RETURN)

            time.sleep(2)        

            SCROLL_PAUSE_TIME = 1

            # Get scroll height
            last_height = driver.execute_script("return document.body.scrollHeight")

            while True:
                # Scroll down to bottom
                driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")

                # Wait to load page
                time.sleep(SCROLL_PAUSE_TIME)

                # Calculate new scroll height and compare with last scroll height
                new_height = driver.execute_script("return document.body.scrollHeight")
                if new_height == last_height:
                    break
                last_height = new_height

            lista_andamentos = driver.find_elements_by_css_selector('#app-root > div > div > div > div.LawsuitRoot-main.col-xs-12.col-md-8 > div > div.LawsuitRoot-list > div > div.LawsuitTimeline-list > *')
            
            childs = 1
            for item in lista_andamentos:

                andamento = driver.find_element_by_css_selector('#app-root > div > div > div > div.LawsuitRoot-main.col-xs-12.col-md-8 > div > div.LawsuitRoot-list > div > div.LawsuitTimeline-list > div:nth-child(' + str(childs) + ')> div.LawsuitTimeline-documents').text
                data_alteracao = driver.find_element_by_css_selector('#app-root > div > div > div > div.LawsuitRoot-main.col-xs-12.col-md-8 > div > div.LawsuitRoot-list > div > div.LawsuitTimeline-list > div:nth-child(' + str(childs) + ')> div.LawsuitTimeline-date > span.LawsuitTimeline-date-absolute').text

                time.sleep(1)

                ### Criando a estrutura JSON de infos do processo
                
                print(data_alteracao)

                data = {}
                data['Processo'] = []
                data['Processo'].append({
                    'n': processo,
                    'data': data_alteracao,
                    'andamento': andamento
                })
                
                time.sleep(2)
                with open("andamento_4.txt", "a", encoding='utf-8') as text_file:
                    text_file.write(str(data))
                    text_file.write("\n\n\n\n\n\n")
                    i += 1
                    print('Andamento nยบ', i, '- sucesso')
                    
                childs += 1
                
            print('Processo ', i + 1, '- sucesso')
                
        except Exception as e:
            print("Tentando novamente ", i+1)
            print(e)
            time.sleep(1)
            
            
        driver.quit()


busca_andamento(driver_1, processos, start = 121, stop = 160)
